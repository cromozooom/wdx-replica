# Implementation Plan: Adaptive Hierarchical Navigation Sidebar

**Branch**: `001-jira-sidebar-nav` | **Date**: 2026-02-27 | **Spec**:
[spec.md](spec.md)  
**Input**: Feature specification from `/specs/001-jira-sidebar-nav/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command following the
workflow in `.specify/templates/commands/plan.md`.

## Summary

Implement a Jira-style hierarchical navigation sidebar with auto-hide behavior,
drag-and-drop menu reordering, and localStorage persistence. The component
provides three visibility states (Hidden 20px, Temporary Visible 280px with
3-second auto-hide, Locked Visible 280px persistent) and an admin edit mode
supporting menu structure management through modals (add, edit, delete, bulk
create). The implementation leverages Angular Material Tree for hierarchy
rendering, CDK Drag-Drop for reordering with circular reference prevention,
signals for reactive state management, and RxJS for auto-hide timer
coordination. All menu changes persist to browser localStorage and survive page
reloads.

## Technical Context

**Language/Version**: TypeScript 5.7+ (strict mode enabled)  
**Primary Dependencies**: Angular 19.2.10 (standalone components, signals),
@angular/material 19.2.10 (Tree, CDK Drag-Drop), @ng-bootstrap/ng-bootstrap
18.0.0 (modals), @ng-select/ng-select 14.9.0 (icon picker), RxJS 7.5+ (reactive
patterns), FontAwesome 6.7.2 Free (icons via CDN)  
**Storage**: Browser localStorage (client-side persistence, no backend
required)  
**Testing**: Karma + Jasmine (existing framework)  
**Target Platform**: Modern web browsers (Chrome 90+, Firefox 88+, Safari 14+,
Edge 90+)  
**Project Type**: Web application feature module  
**Performance Goals**: <300ms state transitions (SC-005), 3-second auto-hide
±500ms tolerance (SC-002), navigation completion <3 seconds (SC-001), edit
operations <2 seconds (SC-010)  
**Constraints**: Support 50+ menu items with 5-level nesting depth without
performance degradation (SC-007), <500KB total bundle impact (constitution
principle IV), OnPush change detection required  
**Scale/Scope**: Single feature module with 9 components, 2 services, 6
interfaces, ~1200 lines of code, 4-hour MVP implementation timeline, 36
functional requirements (FR-001 to FR-035), 10 success criteria, 4 user stories

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

### Principle I: Minimal Dependencies ✅ PASSED

**Assessment**: NO new dependencies required. All functionality implemented with
existing approved dependencies:

- Angular Material 19.2.10 (already approved for UI components) - provides Tree
  and CDK Drag-Drop
- @ng-bootstrap/ng-bootstrap 18.0.0 (already approved) - provides modal system
- @ng-select/ng-select 14.9.0 (already approved) - used for icon picker
- RxJS 7.5+ (already approved for reactive programming)
- FontAwesome 6.7.2 Free (already approved for icons, loaded via CDN)
- Browser localStorage (native Web API, zero bundle impact)

**Bundle Impact**: Estimated <100KB additional gzipped code (component logic +
templates), well within <500KB constitution target.

**Justification**: N/A - no new dependencies to justify.

---

### Principle II: Clean Code Standards ✅ PLANNED COMPLIANCE

**Assessment**: Design follows all clean code requirements:

- **Naming**: Descriptive, intention-revealing names throughout (MenuItem,
  SidebarState, MenuDataService)
- **Functions**: Single responsibility enforced in service methods (CRUD
  operations separated)
- **Components**: Smart/dumb pattern with max 300 lines per file (largest
  component: JiraSidebarContainerComponent ~280 lines estimated)
- **Comments**: Research document emphasizes self-documenting code, WHY-focused
  comments
- **DRY**: Shared utilities in menu-tree.utils.ts, reusable IconPickerComponent,
  MenuValidationService
- **TypeScript Strict**: All interfaces fully typed, no `any` usage planned

**Validation Plan**: ESLint configured for strict mode, code review checklist
includes SRP verification.

---

### Principle III: Component Architecture ✅ PASSED

**Assessment**: Design strictly follows constitutional architecture patterns:

- **Smart/Dumb Pattern**:
  - Smart: `JiraSidebarContainerComponent` (state, modals, localStorage sync)
  - Dumb: `SidebarMenuComponent`, `MenuItemComponent`, `SidebarToggleComponent`,
    `IconPickerComponent`
- **Standalone First**: All new components will be standalone (Angular 19+)
- **Single Concern**: Each component represents one UI concept (menu rendering,
  item display, toggle button, icon picker, modals)
- **Reactive Patterns**: Signals for state management, RxJS for auto-hide timer,
  effect() for localStorage sync
- **Template Complexity**: Complex logic (circular reference detection, tree
  traversal) in services, not templates
- **Reusability**: IconPickerComponent designed as reusable library component,
  MenuValidationService reusable

**Validation Plan**: Code review will verify smart/dumb separation and single
responsibility.

---

### Principle IV: Performance First ✅ PASSED

**Assessment**: Performance is central to design:

- **Bundle Size**: <100KB estimated impact, lazy loading not required (core
  navigation feature)
- **Change Detection**: OnPush strategy mandated for all components (documented
  in research.md section 7)
- **Lazy Loading**: N/A - navigation is core feature, loaded on app
  initialization
- **Memory Management**: RxJS operators use takeUntilDestroyed() (Angular 16+
  pattern), signals + effect() auto-cleanup
- **Asset Optimization**: FontAwesome via CDN (zero bundle impact), no custom
  images
- **Rendering**: Material Tree with trackBy on \*ngFor, expansion state managed
  via Set<string> for O(1) lookup

**Performance Targets Met**:

- SC-005: <300ms transitions via CSS transforms (GPU accelerated)
- SC-002: RxJS timer with 3000ms ±500ms tolerance
- SC-007: Support 50+ items, 5-level depth with OnPush + signals
- SC-010: Edit operations <2 seconds (simple CRUD + localStorage writes)

**Validation Plan**: Performance testing against SC-001, SC-002, SC-005, SC-007,
SC-010 before merge.

---

### ✅ CONSTITUTION COMPLIANCE: PASSED

All four constitutional principles satisfied with zero violations. No complexity
justification required.

## Project Structure

### Documentation (this feature)

```text
specs/001-jira-sidebar-nav/
├── spec.md              # Feature specification (user stories, requirements)
├── plan.md              # This file (/speckit.plan output)
├── research.md          # Phase 0 research (technology patterns, decisions)
├── data-model.md        # Phase 1 data model (TypeScript interfaces)
├── quickstart.md        # Phase 1 quickstart (implementation guide)
├── contracts/           # Phase 1 contracts (component APIs)
│   └── component-interfaces.md
├── checklists/          # Validation checklists
│   └── requirements.md
└── tasks.md             # Phase 2 tasks (/speckit.tasks output - COMPLETED)
```

### Source Code (repository root)

```text
src/app/jira-sidebar-nav/
├── jira-sidebar-nav.component.ts          # Smart container (state, modals, localStorage)
├── jira-sidebar-nav.component.html
├── jira-sidebar-nav.component.scss
├── jira-sidebar-nav.routes.ts
├── components/
│   ├── sidebar-menu/
│   │   ├── sidebar-menu.component.ts       # Dumb (renders Material Tree)
│   │   ├── sidebar-menu.component.html
│   │   └── sidebar-menu.component.scss
│   ├── menu-item/
│   │   ├── menu-item.component.ts          # Dumb (individual item display)
│   │   └── menu-item.component.html
│   ├── sidebar-toggle/
│   │   └── sidebar-toggle.component.ts     # Dumb (lock/unlock button)
│   ├── icon-picker/
│   │   ├── icon-picker.component.ts        # Reusable (ng-select wrapper)
│   │   └── icon-picker.component.html
│   └── modals/
│       ├── menu-item-editor/
│       │   ├── menu-item-editor.component.ts
│       │   └── menu-item-editor.component.html
│       ├── delete-confirmation/
│       │   └── delete-confirmation.component.ts
│       └── add-submenu/
│           ├── add-submenu.component.ts
│           └── add-submenu.component.html
├── models/
│   ├── menu-item.interface.ts             # Core menu item structure
│   ├── sidebar-state.interface.ts         # Visibility + lock state
│   └── menu-structure.interface.ts        # Complete menu hierarchy
├── services/
│   ├── menu-data.service.ts               # CRUD operations + localStorage sync
│   └── menu-validation.service.ts         # Circular reference detection
└── utils/
    ├── menu-tree.utils.ts                 # Tree traversal helpers
    └── font-awesome-icons.const.ts        # Icon definitions (50-100 icons for MVP)
```

**Structure Decision**: Web application feature module using Angular 19+
standalone components with smart/dumb separation. All components co-located
under `src/app/jira-sidebar-nav/` following the established pattern from
existing features (e.g., configuration-manager, garden-room,
spx-magic-selector). Services handle business logic, utils contain pure
functions, models define TypeScript interfaces.

## Complexity Tracking

> **N/A** - No constitutional violations. All principles satisfied without
> exceptions.

---

## Planning Artifacts

All planning phases completed:

- **Phase 0: Research** - [research.md](research.md) - 10 sections covering
  Angular CDK Tree, drag-drop, localStorage, RxJS timers, modals, icon picker,
  performance, architecture, testing, accessibility
- **Phase 1: Data Model** - [data-model.md](data-model.md) - 6 core interfaces
  (MenuItem, SidebarState, MenuStructure, DragDropContext, IconDefinition,
  LocalStorage schema) with utility classes
- **Phase 1: Contracts** -
  [contracts/component-interfaces.md](contracts/component-interfaces.md) - 9
  component APIs (inputs/outputs) and 2 service interfaces
- **Phase 1: Quickstart** - [quickstart.md](quickstart.md) - 10-phase
  implementation guide with code examples, testing checklist, troubleshooting,
  4-hour MVP timeline
- ✅ **Phase 2: Tasks** - [tasks.md](tasks.md) - 84 actionable tasks organized
  by user story with parallel execution opportunities

**Status**: Planning complete. Ready for implementation.

**Next Step**: Begin implementation with Phase 1: Setup (tasks T001-T005)
