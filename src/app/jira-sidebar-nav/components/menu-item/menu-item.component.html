<!-- Menu Item Template (T029, T082) -->
<div
  class="menu-item align-items-stretch gap-2 w-100"
  [class.active]="isActive"
  [class.has-children]="hasChildren"
  [class.has-children-active]="hasChildrenActive"
  [style.padding-left]="getIndentPadding()"
  (click)="onClick($event)"
  [attr.title]="item.label"
>
  <!-- Label with truncation (T082, FR-031) -->
  <!-- Icon -->
  @if (item.icon) {
    <span
      class="ms-2 d-flex align-items-center item-icon"
      [class.py-4]="isLevel0"
      [attr.aria-hidden]="true"
    >
      <i [class]="item.icon"></i>
    </span>
  }
  <span class="item-label d-flex align-items-center" [attr.title]="item.label">
    <span class="item-text">{{ item.label }}</span>
  </span>
  <!-- Badge (if metadata.badgeCount exists) -->
  @if (
    item.metadata && item.metadata.badgeCount && item.metadata.badgeCount > 0
  ) {
    <span class="item-badge">
      {{ item.metadata.badgeCount }}
    </span>
  }

  <div class="d-flex align-items-stretch">
    <!-- Edit Mode Actions (T054, FR-016, FR-017) -->
    @if (isEditMode) {
      <div ngbDropdown container="body" class="ms-auto d-flex flex-grow-1">
        <button
          ngbDropdownToggle
          type="button"
          class="btn btn-outline-on-primary border-0 btn-sm rounded-0"
          (click)="onDropdownToggle($event)"
          title="More actions"
        >
          <i class="fas fa-ellipsis-v"></i>
        </button>
        <div ngbDropdownMenu>
          <button ngbDropdownItem (click)="onEditClick($event)">
            <i class="fas fa-edit me-3"></i>Edit
          </button>
          <button ngbDropdownItem (click)="onAddChildClick($event)">
            <i class="fas fa-plus me-3"></i>Add Child
          </button>
          <button ngbDropdownItem (click)="onDeleteClick($event)">
            <i class="fas fa-trash me-3"></i>Delete
          </button>
        </div>
      </div>
    }

    <!-- Expansion Icon (if has children) -->
    @if (hasChildren) {
      <button
        class="btn btn-outline-on-primary border-0 btn-sm d-flex align-items-center justify-content-center text-decoration-none rounded-0"
        style="width: 1.3rem"
        [class.expanded]="isExpanded"
        (click)="onToggleExpansion($event)"
        role="button"
        [attr.aria-expanded]="isExpanded"
        [attr.aria-label]="isExpanded ? 'Collapse' : 'Expand'"
      >
        <i
          [class]="isExpanded ? 'fas fa-chevron-down' : 'fas fa-chevron-right'"
        ></i>
      </button>
    }
  </div>
</div>
