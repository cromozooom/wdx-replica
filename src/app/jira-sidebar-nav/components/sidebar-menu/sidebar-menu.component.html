<!-- Sidebar Menu Template (T028) -->
<nav class="sidebar-menu" role="navigation" aria-label="Main navigation">
  <ul class="menu-tree root-level">
    @for (item of menuItems; track trackByItemId($index, item)) {
      <li class="menu-tree-node">
        <!-- Menu Item Component -->
        <app-menu-item
          [item]="item"
          [level]="0"
          [isActive]="activeItemId === item.id"
          [hasChildren]="hasChildren(item)"
          [isExpanded]="isExpanded(item.id)"
          [isEditMode]="isEditMode"
          (itemClicked)="onItemClick($event)"
          (expansionToggled)="toggleNode(item)"
        ></app-menu-item>

        <!-- Recursive Children -->
        @if (hasChildren(item) && isExpanded(item.id)) {
          <ul class="menu-tree nested-level">
            @for (child of item.children; track trackByItemId($index, child)) {
              <li class="menu-tree-node">
                <app-menu-item
                  [item]="child"
                  [level]="1"
                  [isActive]="activeItemId === child.id"
                  [hasChildren]="hasChildren(child)"
                  [isExpanded]="isExpanded(child.id)"
                  [isEditMode]="isEditMode"
                  (itemClicked)="onItemClick($event)"
                  (expansionToggled)="toggleNode(child)"
                ></app-menu-item>

                <!-- Level 2 Children -->
                @if (hasChildren(child) && isExpanded(child.id)) {
                  <ul class="menu-tree nested-level">
                    @for (
                      grandchild of child.children;
                      track trackByItemId($index, grandchild)
                    ) {
                      <li class="menu-tree-node">
                        <app-menu-item
                          [item]="grandchild"
                          [level]="2"
                          [isActive]="activeItemId === grandchild.id"
                          [hasChildren]="hasChildren(grandchild)"
                          [isExpanded]="isExpanded(grandchild.id)"
                          [isEditMode]="isEditMode"
                          (itemClicked)="onItemClick($event)"
                          (expansionToggled)="toggleNode(grandchild)"
                        ></app-menu-item>

                        <!-- Level 3 Children -->
                        @if (
                          hasChildren(grandchild) && isExpanded(grandchild.id)
                        ) {
                          <ul class="menu-tree nested-level">
                            @for (
                              greatgrandchild of grandchild.children;
                              track trackByItemId($index, greatgrandchild)
                            ) {
                              <li class="menu-tree-node">
                                <app-menu-item
                                  [item]="greatgrandchild"
                                  [level]="3"
                                  [isActive]="
                                    activeItemId === greatgrandchild.id
                                  "
                                  [hasChildren]="hasChildren(greatgrandchild)"
                                  [isExpanded]="isExpanded(greatgrandchild.id)"
                                  [isEditMode]="isEditMode"
                                  (itemClicked)="onItemClick($event)"
                                  (expansionToggled)="
                                    toggleNode(greatgrandchild)
                                  "
                                ></app-menu-item>

                                <!-- Level 4 Children (max depth) -->
                                @if (
                                  hasChildren(greatgrandchild) &&
                                  isExpanded(greatgrandchild.id)
                                ) {
                                  <ul class="menu-tree nested-level">
                                    @for (
                                      level5 of greatgrandchild.children;
                                      track trackByItemId($index, level5)
                                    ) {
                                      <li class="menu-tree-node">
                                        <app-menu-item
                                          [item]="level5"
                                          [level]="4"
                                          [isActive]="
                                            activeItemId === level5.id
                                          "
                                          [hasChildren]="hasChildren(level5)"
                                          [isExpanded]="isExpanded(level5.id)"
                                          [isEditMode]="isEditMode"
                                          (itemClicked)="onItemClick($event)"
                                          (expansionToggled)="
                                            toggleNode(level5)
                                          "
                                        ></app-menu-item>
                                      </li>
                                    }
                                  </ul>
                                }
                              </li>
                            }
                          </ul>
                        }
                      </li>
                    }
                  </ul>
                }
              </li>
            }
          </ul>
        }
      </li>
    }
  </ul>
</nav>
