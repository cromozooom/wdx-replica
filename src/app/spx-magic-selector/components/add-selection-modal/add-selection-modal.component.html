<div class="offcanvas-header p-0">
  <div class="d-flex flex-column flex-grow-1 border-bottom">
    <div class="d-flex justify-content-between align-items-center px-2 py-2">
      <h5
        class="h6 gap-2 offcanvas-title p-0 mb-0 d-flex gap-1 align-items-center"
      >
        <i class="fa fa-plus-circle"></i>
        Add New Selection
      </h5>
      <button
        type="button"
        class="btn-close me-2"
        aria-label="Close"
        (click)="cancel()"
      ></button>
    </div>
    <app-offcanvas-breadcrumb></app-offcanvas-breadcrumb>
  </div>
</div>

<div
  class="offcanvas-body w-100 d-flex flex-column flex-grow-1 p-0 overflow-hidden"
>
  <div class="d-flex flex-grow-1 w-100 flex-column overflow-hidden">
    <div
      class="d-flex flex-grow-1 flex-column gap-2 overflow-x-hidden overflow-y-scroll px-2 py-2"
    >
      <div class="row gap-0">
        <div class="col-6">
          <!-- Selection Name -->
          <div>
            <label class="form-label fw-bold">Selection Name *</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="selectionName"
              placeholder="e.g., My Quarterly Report Selection"
              maxlength="100"
            />
            <div class="form-text">
              Give this selection a memorable name for future reference
            </div>
          </div>
        </div>
        <div class="col-6">
          <!-- Domain Selection -->
          <div>
            <label class="form-label fw-bold">Bulk Edit type</label>
            <select
              class="form-select"
              [(ngModel)]="selectedDomain"
              (ngModelChange)="onDomainChange()"
            >
              <option
                *ngFor="let key of domainTypeKeys"
                [value]="domainTypes[key].id"
              >
                {{ domainTypes[key].label }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- SPX Magic Selector -->
      <div>
        <label class="form-label fw-bold">Select Form or Document *</label>
        <app-spx-magic-selector
          [domainId]="selectedDomain"
          [placeholder]="'Choose a form or document...'"
          (selectionChange)="onSelectionChange($event)"
        ></app-spx-magic-selector>
      </div>

      <!-- Selection Preview -->
      <div *ngIf="lastEvent" class="alert alert-success">
        <h6 class="alert-heading">
          <i class="fa fa-check-circle me-1"></i>
          Selection Preview
        </h6>
        <div class="row g-2 small">
          <div class="col-md-6">
            <strong>Item:</strong> {{ lastEvent.selectedItem?.name }}
          </div>
          <div class="col-md-6">
            <strong>Entity:</strong> {{ lastEvent.selectedItem?.entityName }}
          </div>
          <div class="col-md-6">
            <strong>Query:</strong> {{ lastEvent.selectedQuery?.name }}
          </div>
          <div class="col-md-6">
            <strong>Type:</strong> {{ lastEvent.selectedItem?.type }}
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer Buttons -->
  <div class="d-flex justify-content-end gap-2 p-2 border-top">
    <button type="button" class="btn btn-secondary" (click)="cancel()">
      <i class="fa fa-times me-1"></i>
      Cancel
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="save()"
      [disabled]="!canSave()"
    >
      <i class="fa fa-save me-1"></i>
      Save Selection
    </button>
  </div>
</div>
