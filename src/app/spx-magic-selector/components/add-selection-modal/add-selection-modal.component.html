<div class="offcanvas-header p-0">
  <div class="d-flex flex-column flex-grow-1 border-bottom">
    <div class="d-flex justify-content-between align-items-center px-2 py-2">
      <h5
        class="h6 gap-2 offcanvas-title p-0 mb-0 d-flex gap-1 align-items-center"
      >
        <i class="fa fa-plus-circle"></i>
        Add New Bulk Edit
      </h5>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        (click)="cancel()"
      ></button>
    </div>
    <app-offcanvas-breadcrumb></app-offcanvas-breadcrumb>
  </div>
</div>

<div
  class="offcanvas-body w-100 d-flex flex-column flex-grow-1 p-0 overflow-hidden"
>
  <div class="d-flex flex-grow-1 w-100 flex-column overflow-hidden">
    <div
      class="d-flex flex-grow-1 flex-column gap-2 overflow-x-hidden overflow-y-scroll px-2 py-2"
    >
      <div class="container" style="max-width: 60rem">
        <div class="row gap-0 pt-2">
          <div class="col-12 pb-3">
            <div class="px-0">
              <div class="p-3 bg-warning-subtle text-warning-emphasis rounded">
                <!-- <div class="mb-2">
                  <i class="fa fa-info-circle me-1"></i>
                  <strong>How it works:</strong> Each form contains multiple
                  queries. The selector shows all possible
                  <strong>(form Ã— query) combinations</strong> as selectable
                  items. Search filters across
                  <strong
                    >form names, descriptions, entities, and categories</strong
                  >
                  in real-time with sub-millisecond performance.
                </div>
                <div class="small text-muted mb-2">
                  ðŸ’¡ <strong>Tip:</strong> Type any keyword to instantly filter
                  hundreds of items. The selector handles 1000+ combinations
                  with <strong>&lt;1ms</strong> search response.
                </div> -->

                <!-- Performance Metrics -->
                <div
                  *ngIf="
                    selectorComponent &&
                    selectorComponent.performanceMetrics.lastLoadTime > 0
                  "
                  class=""
                >
                  <div class="small d-flex gap-3">
                    <strong>âš¡ Performance Metrics:</strong>
                    <span>
                      <i class="fa fa-bolt"></i>
                      Load:
                      <strong
                        >{{
                          selectorComponent.performanceMetrics.lastLoadTime.toFixed(
                            2
                          )
                        }}ms</strong
                      >
                    </span>
                    <span
                      *ngIf="
                        selectorComponent.performanceMetrics.lastFilterTime > 0
                      "
                    >
                      <i class="fa fa-search"></i>
                      Filter:
                      <strong
                        >{{
                          selectorComponent.performanceMetrics.lastFilterTime.toFixed(
                            2
                          )
                        }}ms</strong
                      >
                    </span>
                    <span>
                      <i class="fa fa-database"></i>
                      Items:
                      <strong
                        >{{
                          selectorComponent.performanceMetrics.filteredRows
                        }}/{{
                          selectorComponent.performanceMetrics.totalRows
                        }}</strong
                      >
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6">
            <!-- Selection Name -->
            <div>
              <label class="form-label fw-bold">Bulk Edit Name *</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="selectionName"
                placeholder="e.g., My Quarterly Report Selection"
                maxlength="100"
              />
              <div class="form-text">
                Give this selection a memorable name for future reference
              </div>
            </div>
          </div>
          <div class="col-6">
            <!-- Domain Selection -->
            <div>
              <label class="form-label fw-bold">Bulk Edit type</label>
              <select
                class="form-select"
                [(ngModel)]="selectedDomain"
                (ngModelChange)="onDomainChange()"
              >
                <option
                  *ngFor="let key of domainTypeKeys"
                  [value]="domainTypes[key].id"
                >
                  {{ domainTypes[key].label }}
                </option>
              </select>
            </div>
          </div>
          <!-- SPX Magic Selector -->
          <div class="col-12 pt-4">
            <label class="form-label fw-bold"
              >Select {{ itemTypeLabel }} *
            </label>
            <app-spx-magic-selector
              [domainId]="selectedDomain"
              [placeholder]="'Choose a ' + itemTypeLabel.toLowerCase() + '...'"
              (selectionChange)="onSelectionChange($event)"
            ></app-spx-magic-selector>
          </div>
          <div class="col-12 pt-2">
            <div class="px-0">
              <div class="p-3 bg-info-subtle text-info-emphasis rounded">
                <div class="">
                  If you don't find the query you're looking for, click this
                  <a href="" class="text-info-emphasis fw-bold" target="_blank">
                    link
                  </a>
                  to open the editor. Or use
                  <strong> Tool section </strong>
                  from the root page to add more queries.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Selection Preview -->
        <!-- <div *ngIf="lastEvent" class="alert alert-success">
        <h6 class="alert-heading">
          <i class="fa fa-check-circle me-1"></i>
          Selection Preview
        </h6>
        <div class="row g-2 small">
          <div class="col-md-6">
            <strong>Item:</strong> {{ lastEvent.selectedItem?.name }}
          </div>
          <div class="col-md-6">
            <strong>Entity:</strong> {{ lastEvent.selectedItem?.entityName }}
          </div>
          <div class="col-md-6">
            <strong>Query:</strong> {{ lastEvent.selectedQuery?.name }}
          </div>
          <div class="col-md-6">
            <strong>Type:</strong> {{ lastEvent.selectedItem?.type }}
          </div>
        </div>
      </div> -->
      </div>
    </div>
    <!-- Footer Buttons -->
    <div class="d-flex justify-content-between gap-2 p-2 border-top">
      <div>
        <button
          type="button"
          class="btn btn-outline-primary"
          (click)="cancel()"
        >
          Cancel
        </button>
      </div>
      <div>
        <button
          type="button"
          class="btn btn-primary"
          (click)="save()"
          [disabled]="!canSave()"
        >
          <i class="fa fa-save me-1"></i>
          Save
        </button>
      </div>
    </div>
  </div>
</div>
