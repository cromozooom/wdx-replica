<div class="offcanvas-header p-0">
  <div class="d-flex flex-column flex-grow-1 border-bottom">
    <div class="d-flex justify-content-between align-items-center py-2">
      <div class="d-flex align-items-center gap-3 ps-2">
        <h5
          class="h6 gap-2 offcanvas-title p-0 mb-0 d-flex gap-1 align-items-center"
        >
          <i class="fa fa-search"></i>
          {{ data.modalTitle || "Advanced Lookup" }}
        </h5>
        <!-- View toggle switch -->
        <div class="form-check form-switch mb-0">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            id="viewToggle"
            [checked]="viewMode === 'graph'"
            (change)="toggleView()"
          />
          <label class="form-check-label small" for="viewToggle">
            <!-- <i class="fa fa-project-diagram me-1"></i> -->
            <!-- switch label between states Graph and Grid -->
            Graph View
            <!-- {{ viewMode === "graph" ? "Graph View" : "Grid View" }} -->
          </label>
        </div>
      </div>
      <button
        type="button"
        class="btn-close me-2"
        aria-label="Close"
        (click)="cancel()"
      ></button>
    </div>
    <app-offcanvas-breadcrumb></app-offcanvas-breadcrumb>
  </div>
</div>

<div
  class="offcanvas-body w-100 d-flex flex-column flex-grow-1 p-0 overflow-hidden"
>
  <!-- D3.js Graph View -->
  <div
    *ngIf="viewMode === 'graph'"
    class="d-flex flex-column flex-grow-1 overflow-hidden"
  >
    <!-- Search Filter -->
    <div class="p-2 border-bottom">
      <div class="input-group input-group-sm">
        <span class="input-group-text">
          <i class="fa fa-search"></i>
        </span>
        <input
          type="text"
          class="form-control"
          placeholder="xSearch all columns..."
          [(ngModel)]="quickFilterText"
          (input)="onQuickFilterChanged($event)"
        />
        <button
          class="btn btn-outline-secondary"
          type="button"
          (click)="clearQuickFilter()"
          [disabled]="!quickFilterText"
        >
          <i class="fa fa-times"></i>
        </button>
      </div>
    </div>
    <!-- Graph Container -->
    <div #graphContainer class="flex-grow-1 position-relative bg-body">
      <!-- Legend -->
      <div
        class="position-absolute top-0 end-0 m-3 bg-white border rounded p-3 shadow-sm"
        style="z-index: 10"
      >
        <h6 class="small fw-bold mb-2">Legend</h6>
        <div class="d-flex flex-column gap-2" style="font-size: 0.875rem">
          <div class="d-flex align-items-center gap-2">
            <div
              style="
                width: 16px;
                height: 16px;
                background: #10b981;
                border-radius: 50%;
              "
            ></div>
            <span>Source (Form/Document)</span>
          </div>
          <div class="d-flex align-items-center gap-2">
            <div
              style="
                width: 16px;
                height: 16px;
                background: #3b82f6;
                border-radius: 50%;
              "
            ></div>
            <span>Entity</span>
          </div>
          <div class="d-flex align-items-center gap-2">
            <div
              style="
                width: 16px;
                height: 16px;
                background: #f59e0b;
                border-radius: 50%;
              "
            ></div>
            <span>Query</span>
          </div>
        </div>
        <hr class="my-2" />
        <div class="small text-muted">
          <i class="fa fa-search-plus me-1"></i>Scroll to zoom<br />
          <i class="fa fa-hand-paper me-1"></i>Drag to pan/reposition
        </div>
      </div>
    </div>
  </div>

  <!-- AG-Grid View -->
  <div *ngIf="viewMode === 'grid'" class="d-flex flex-grow-1">
    <div
      class="w-75 d-flex flex-column border-end flex-grow-1 overflow-hidden p-2"
    >
      <div class="px-0 pb-2">
        <div class="p-3 bg-info-subtle text-info-emphasis rounded">
          If you don't find the query that you're looking for, click this
          <a href="" class="text-info-emphasis fw-bold" target="_blank">
            link
          </a>
          to open the editor. Or use
          <strong> Tool section </strong>
          from the root page to add more queries to the list.
        </div>
      </div>
      <!-- Search Filter -->
      <div class="pb-2">
        <div class="input-group input-group-sm">
          <span class="input-group-text">
            <i class="fa fa-search"></i>
          </span>
          <input
            type="text"
            class="form-control"
            placeholder="Search all columns..."
            [(ngModel)]="quickFilterText"
            (input)="onQuickFilterChanged($event)"
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="clearQuickFilter()"
            [disabled]="!quickFilterText"
          >
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>
      <ag-grid-angular
        class="ag-theme-alpine w-100 h-100"
        [rowData]="rowData"
        [columnDefs]="columnDefs"
        [defaultColDef]="defaultColDef"
        [gridOptions]="gridOptions"
        [getRowId]="getRowId"
        (gridReady)="onGridReady($event)"
        (rowClicked)="onRowClicked($event)"
        (rowDoubleClicked)="onRowDoubleClicked($event)"
      >
      </ag-grid-angular>
    </div>
    <div class="w-25 d-flex flex-column flex-grow-1 overflow-hidden p-2">
      <app-inspector-panel
        class="d-flex flex-column w-100 h-100"
        [inspectedRow]="selectedRow"
        [previewData]="previewData"
        [queryParameters]="queryParameters"
        [loading]="previewLoading"
        [error]="previewError"
        (previewRefresh)="onPreviewRefresh($event)"
      ></app-inspector-panel>
    </div>
  </div>

  <!-- Footer buttons -->
  <div class="d-flex justify-content-between gap-2 p-2 border-top">
    <div>
      <button type="button" class="btn btn-outline-primary" (click)="cancel()">
        Cancel
      </button>
    </div>
    <div>
      <button
        type="button"
        class="btn btn-primary"
        (click)="confirmSelection()"
        [disabled]="!selectedRow"
      >
        <i class="fa fa-check me-1"></i>
        Select
      </button>
    </div>
  </div>
</div>
<!-- <div
  class="offcanvas-body w-100 d-flex flex-column flex-grow-1 p-0 overflow-hidden"
>
  <div class="d-flex gap-2 flex-grow-1 w-100 flex-column overflow-hidden">
    <div class="text-muted p-2">
      <i class="fa fa-info-circle me-1"></i>
      Browse all available form-entity-query combinations. Click a row to
      inspect data preview, or double-click to confirm selection.
    </div>
    <div class="row g-0 flex-grow-1">
      <div class="col-12 px-2">
        <div class="mt-3 p-3 bg-light rounded" *ngIf="selectedRow">
          <div class="row">
            <div class="col-md-4">
              <label class="text-muted small mb-1">Selected Item</label>
              <div>
                <strong>{{ selectedRow.sourceName }}</strong>
              </div>
            </div>
            <div class="col-md-4">
              <label class="text-muted small mb-1">Entity</label>
              <div>{{ selectedRow.entityName }}</div>
            </div>
            <div class="col-md-4">
              <label class="text-muted small mb-1">Query</label>
              <div>{{ selectedRow.queryName }}</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-7 p-2">
        <ag-grid-angular
          class="ag-theme-alpine w-100 h-100"
          [rowData]="rowData"
          [columnDefs]="columnDefs"
          [defaultColDef]="defaultColDef"
          [gridOptions]="gridOptions"
          [getRowId]="getRowId"
          (gridReady)="onGridReady($event)"
          (rowClicked)="onRowClicked($event)"
          (rowDoubleClicked)="onRowDoubleClicked($event)"
        >
        </ag-grid-angular>
      </div>

      <div class="col-5 overflow-y-scroll">
        <app-inspector-panel
          [inspectedRow]="selectedRow"
          [previewData]="previewData"
          [queryParameters]="queryParameters"
          [loading]="previewLoading"
          [error]="previewError"
          (previewRefresh)="onPreviewRefresh($event)"
        ></app-inspector-panel>
      </div>
    </div>
  </div>

  
</div> -->
