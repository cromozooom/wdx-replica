<div class="preview-container mt-3" *ngIf="selectedItem && selectedQuery">
  <!-- Network Error Warning Banner -->
  <div
    class="alert alert-warning alert-dismissible fade show mb-2"
    role="alert"
    *ngIf="networkError"
  >
    <i class="fa fa-exclamation-triangle me-2"></i>
    <strong>Network Error:</strong> Unable to fetch live data. Showing cached
    information.
    <button
      type="button"
      class="btn btn-sm btn-warning ms-3"
      (click)="retryLoadCount()"
    >
      <i class="fa fa-refresh me-1"></i>
      Retry
    </button>
  </div>

  <!-- Preview Card -->
  <div class="card">
    <div class="card-header bg-body">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
          <i class="fa fa-eye me-2"></i>
          Selection Preview
        </h6>
        <button
          class="btn btn-sm btn-outline-secondary"
          (click)="refreshPreview()"
          [disabled]="loadingCount"
        >
          <i class="fa fa-refresh me-1"></i>
          Refresh
        </button>
      </div>
    </div>

    <div class="card-body">
      <!-- Item Type Badge -->
      <div class="mb-3">
        <span
          class="badge me-2"
          [ngClass]="
            selectedItem.type === 'Form'
              ? 'bg-info-subtle text-info-emphasis'
              : 'bg-success-subtle text-success-emphasis'
          "
        >
          {{ selectedItem.type }}
        </span>
        <strong>{{ selectedItem.name }}</strong>
      </div>

      <!-- Entity Mapping -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label class="text-muted small mb-1">Entity Type</label>
          <div>
            <i class="fa fa-database me-1"></i>
            <strong>{{ selectedItem.entityName }}</strong>
          </div>
        </div>

        <!-- Record Count Badge -->
        <div class="col-md-6" *ngIf="showRecordCount">
          <label class="text-muted small mb-1">Record Count</label>
          <div>
            <span
              class="badge bg-info"
              *ngIf="!loadingCount && recordCount !== null"
            >
              {{ recordCount | number }} records
              <span
                class="ms-1"
                *ngIf="recordCount && recordCount >= 1000"
                title="Approximate count (Â±10%)"
              >
                ~
              </span>
            </span>
            <span class="badge bg-secondary" *ngIf="loadingCount">
              <i class="fa fa-spinner fa-spin me-1"></i>
              Loading...
            </span>
            <span
              class="badge bg-warning"
              *ngIf="!loadingCount && recordCount === null"
            >
              Count unavailable
            </span>
          </div>
        </div>
      </div>

      <!-- Query Description -->
      <div class="mb-2">
        <label class="text-muted small mb-1">Active Query</label>
        <div>
          <strong>{{ selectedQuery.name }}</strong>
        </div>
      </div>

      <div>
        <label class="text-muted small mb-1">Description</label>
        <p class="mb-0 text-muted">
          {{ selectedQuery.description }}
        </p>
      </div>

      <!-- Item Description (if available) -->
      <div class="mt-3 pt-3 border-top" *ngIf="selectedItem.description">
        <label class="text-muted small mb-1">Item Details</label>
        <p class="mb-0 text-muted small">
          {{ selectedItem.description }}
        </p>
      </div>
    </div>
  </div>
</div>
