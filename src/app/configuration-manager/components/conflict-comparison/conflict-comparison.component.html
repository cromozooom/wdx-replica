<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
    Configuration Conflict: {{ conflict.importedConfig.name }}
  </h5>
  <button
    type="button"
    class="btn-close"
    aria-label="Close"
    (click)="onClose()"
  ></button>
</div>

<div class="modal-body">
  <div class="conflict-comparison">
    <div class="alert alert-warning mb-3">
      <strong>Configuration ID:</strong> {{ conflict.configId }}
      <span class="ms-3"
        ><strong>Type:</strong> {{ conflict.importedConfig.type }}</span
      >
    </div>

    <!-- Metadata Changes -->
    @if (getMetadataChanges().length > 0) {
      <div class="metadata-section mb-4">
        <h6 class="section-title">
          <i class="bi bi-info-circle me-2"></i>
          Metadata Changes
        </h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered">
            <thead class="table-light">
              <tr>
                <th>Field</th>
                <th class="bg-danger bg-opacity-10">Existing</th>
                <th class="bg-success bg-opacity-10">Imported</th>
              </tr>
            </thead>
            <tbody>
              @for (change of getMetadataChanges(); track change.field) {
                <tr>
                  <td>
                    <strong>{{ change.field }}</strong>
                  </td>
                  <td class="existing-value">{{ change.existing }}</td>
                  <td class="imported-value">{{ change.imported }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- Content Changes with Ace Editor -->
    @if (conflict.differences.content.hasChanges) {
      <div class="content-section mb-4">
        <h6 class="section-title">
          <i class="bi bi-file-earmark-code me-2"></i>
          Content Differences
        </h6>
        <div class="row">
          <div class="col-6">
            <div class="content-panel">
              <div class="content-label bg-danger text-white">
                <i class="bi bi-arrow-left me-2"></i>
                Existing Version
              </div>
              <app-ace-editor
                [value]="
                  getFormattedContent(
                    conflict.differences.content.existing || ''
                  )
                "
                [mode]="
                  conflict.importedConfig.type.includes('JSON') ? 'text' : 'xml'
                "
              ></app-ace-editor>
            </div>
          </div>
          <div class="col-6">
            <div class="content-panel">
              <div class="content-label bg-success text-white">
                <i class="bi bi-arrow-right me-2"></i>
                Imported Version
              </div>
              <app-ace-editor
                [value]="
                  getFormattedContent(conflict.differences.content.imported)
                "
                [mode]="
                  conflict.importedConfig.type.includes('JSON') ? 'text' : 'xml'
                "
              ></app-ace-editor>
            </div>
          </div>
        </div>
      </div>
    } @else {
      <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        No content changes detected - only metadata differs.
      </div>
    }

    <!-- Basket Changes -->
    @if (conflict.differences.basket.hasChanges) {
      <div class="basket-section mb-4">
        <h6 class="section-title">
          <i class="bi bi-basket me-2"></i>
          Basket Assignment
        </h6>
        <div class="alert alert-info">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>Existing Basket:</strong>
              {{ conflict.differences.basket.existing || "None" }}
            </div>
            <div>
              <i class="bi bi-arrow-right mx-3"></i>
            </div>
            <div>
              <strong>Target Basket:</strong>
              {{ conflict.differences.basket.imported || "None" }}
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>

<div class="modal-footer">
  <div class="w-100">
    <h6 class="mb-3">
      <i class="bi bi-check-circle me-2"></i>
      Choose Resolution
    </h6>
    <div class="btn-group w-100" role="group">
      <button
        type="button"
        class="btn btn-primary"
        (click)="onResolve('overwrite')"
        title="Replace existing configuration with imported version"
      >
        <i class="bi bi-arrow-clockwise me-2"></i>
        <div>
          <strong>Overwrite</strong>
          <small class="d-block">Use imported version</small>
        </div>
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onResolve('keep')"
        title="Keep existing configuration, skip import"
      >
        <i class="bi bi-shield-check me-2"></i>
        <div>
          <strong>Keep Existing</strong>
          <small class="d-block">Skip this import</small>
        </div>
      </button>
      <button
        type="button"
        class="btn btn-success"
        (click)="onResolve('import-as-new')"
        title="Import with a new ID"
      >
        <i class="bi bi-plus-circle me-2"></i>
        <div>
          <strong>Import as New</strong>
          <small class="d-block">Create duplicate</small>
        </div>
      </button>
    </div>
  </div>
</div>
