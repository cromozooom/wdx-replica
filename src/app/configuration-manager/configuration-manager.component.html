@if (!showEditor) {
  <header class="header border-bottom">
    <div class="d-flex justify-content-between align-items-center p-2">
      <div class="d-flex align-items-center gap-3">
        <h2 class="h6 mb-0">Configuration Manager</h2>

        <!-- Basket Selector -->
        <div class="basket-selector">
          <div class="btn-group">
            @for (basket of store.baskets(); track basket.id) {
              <button
                type="button"
                class="btn btn-sm"
                [class.btn-primary]="store.currentBasketId() === basket.id"
                [class.btn-outline-secondary]="
                  store.currentBasketId() !== basket.id
                "
                (click)="selectBasket(basket.id)"
              >
                {{ basket.name }}
                <span class="badge bg-light text-dark ms-1">{{
                  basket.configurationIds.length
                }}</span>
              </button>
            }
            <button
              type="button"
              class="btn btn-sm btn-outline-success"
              (click)="openBasketModal()"
              title="Create new basket"
            >
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="btn-group">
        <!-- Import Action -->
        <button
          class="btn btn-sm btn-outline-success"
          (click)="onImport()"
          title="Import configurations from ZIP"
        >
          <i class="fas fa-file-import me-1"></i>
          Import
        </button>

        <!-- Export Actions -->
        @if (store.selectedConfigurations().length > 0) {
          <button
            class="btn btn-sm btn-outline-info"
            (click)="onExportSelected()"
            [disabled]="exporting"
            title="Export selected configurations as ZIP"
          >
            <i class="fas fa-file-export me-1"></i>
            @if (exporting) {
              <span class="spinner-border spinner-border-sm me-1"></span>
            }
            Export Selected ({{ store.selectedConfigurations().length }})
          </button>
        }

        @if (store.currentBasket() && store.basketConfigurations().length > 0) {
          <button
            class="btn btn-sm btn-outline-primary"
            (click)="onExportBasket()"
            [disabled]="exporting"
            title="Export entire basket as ZIP"
          >
            <i class="fas fa-download me-1"></i>
            @if (exporting) {
              <span class="spinner-border spinner-border-sm me-1"></span>
            }
            Export Basket
          </button>
        }

        <!-- Basket Actions -->
        @if (store.currentBasketId() && selectedConfigurations.length > 0) {
          <div class="dropdown">
            <button
              class="btn btn-sm btn-outline-primary dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
            >
              <i class="fas fa-shopping-basket me-1"></i>
              Add to Basket
            </button>
            <ul class="dropdown-menu">
              @for (basket of store.baskets(); track basket.id) {
                @if (basket.id !== store.currentBasketId()) {
                  <li>
                    <a
                      class="dropdown-item"
                      (click)="addSelectedToBasket(basket.id)"
                    >
                      {{ basket.name }}
                    </a>
                  </li>
                }
              }
            </ul>
          </div>

          <button
            class="btn btn-sm btn-outline-danger"
            (click)="removeSelectedFromBasket()"
            title="Remove selected from current basket"
          >
            <i class="fas fa-minus-circle me-1"></i>
            Remove from Basket
          </button>
        }

        <button
          class="btn btn-sm btn-outline-secondary"
          (click)="onResetDatabase()"
        >
          <i class="fas fa-sync me-2"></i>
          Reset Database
        </button>
        <button
          class="btn btn-sm btn-outline-warning"
          (click)="onForceDeleteDatabase()"
        >
          <i class="fas fa-trash me-2"></i>
          Force Delete DB
        </button>
        <button
          class="btn btn-sm btn-outline-success"
          (click)="onSeedSampleData()"
        >
          <i class="fas fa-seedling me-2"></i>
          Seed Sample Data
        </button>
        <button
          class="btn btn-sm btn-outline-primary"
          (click)="onNewConfiguration()"
        >
          <i class="fas fa-plus me-2"></i>
          New Configuration
        </button>
      </div>
    </div>
  </header>

  @if (store.error()) {
    <div class="alert alert-danger alert-dismissible">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ store.error() }}
    </div>
  }

  <app-configuration-grid
    class="flex-grow-1 p-2"
    [configurations]="store.filteredConfigurations()"
    [loading]="store.loading()"
    [selectedType]="store.filterType()"
    [searchTerm]="store.searchTerm()"
    (rowDoubleClicked)="onRowDoubleClicked($event)"
    (selectionChanged)="onSelectionChanged($event)"
    (typeFilterChanged)="onTypeFilterChanged($event)"
    (searchTermChanged)="onSearchTermChanged($event)"
  ></app-configuration-grid>
}

@if (showEditor) {
  <app-configuration-editor
    [configuration]="editingConfiguration ?? undefined"
    (saved)="onSaveConfiguration($event)"
    (cancelled)="onCancelEditor()"
  ></app-configuration-editor>
}

<!-- Basket Creation Modal -->
@if (showBasketModal) {
  <div
    class="modal fade show d-block"
    tabindex="-1"
    style="background-color: rgba(0, 0, 0, 0.5)"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Basket</h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeBasketModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="basketName" class="form-label">Basket Name</label>
            <input
              type="text"
              class="form-control"
              id="basketName"
              [(ngModel)]="newBasketName"
              placeholder="e.g., UAT, Test, Staging"
              (keyup.enter)="createBasket()"
              autofocus
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="closeBasketModal()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="createBasket()"
            [disabled]="!newBasketName.trim()"
          >
            Create Basket
          </button>
        </div>
      </div>
    </div>
  </div>
}
