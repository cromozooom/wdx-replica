<header class="header border-bottom d-flex flex-column">
  <div class="d-flex justify-content-between align-items-center">
    <div class="flex-grow-1 d-flex">
      <div class="d-flex justify-content-between align-items-center gap-2 p-2">
        <div class="d-flex align-items-center gap-3">
          <div class="basket-selector d-flex gap-2">
            <div class="btn-group">
              @for (basket of store.baskets(); track basket.id) {
                <button
                  type="button"
                  class="btn btn-sm"
                  [class.btn-secondary]="store.currentBasketId() === basket.id"
                  [class.btn-outline-secondary]="
                    store.currentBasketId() !== basket.id
                  "
                  (click)="selectBasket(basket.id)"
                >
                  {{ basket.name }}
                  <span class="badge bg-light text-dark ms-1">{{
                    basket.configurationIds.length
                  }}</span>
                </button>
              }
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                (click)="openBasketModal()"
                title="Create new basket"
              >
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Import Action -->
        <button
          class="btn btn-sm btn-outline-primary"
          (click)="onImport()"
          title="Import configurations from ZIP"
        >
          <i class="fas fa-file-import me-1"></i>
          Import
        </button>
        <div class="btn-group">
          <!-- Export Actions -->
          @if (store.selectedConfigurations().length > 0) {
            <button
              class="btn btn-sm btn-outline-primary"
              (click)="onExportSelected()"
              [disabled]="exporting"
              title="Export selected configurations as ZIP"
            >
              <i class="fas fa-file-export me-1"></i>
              @if (exporting) {
                <span class="spinner-border spinner-border-sm me-1"></span>
              }
              Export Selected ({{ store.selectedConfigurations().length }})
            </button>
          }

          @if (
            store.currentBasket() && store.basketConfigurations().length > 0
          ) {
            <button
              class="btn btn-sm btn-outline-primary"
              (click)="onExportBasket()"
              [disabled]="exporting"
              title="Export entire basket as ZIP"
            >
              <i class="fas fa-download me-1"></i>
              @if (exporting) {
                <span class="spinner-border spinner-border-sm me-1"></span>
              }
              Export All
            </button>
          }

          <!-- Basket Actions -->
          <!-- @if (store.currentBasketId() && selectedConfigurations.length > 0) {
              <div class="dropdown">
                <button
                class="btn btn-sm btn-outline-primary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
                >
                  <i class="fas fa-shopping-basket me-1"></i>
                  Add to Basket
                </button>
                <ul class="dropdown-menu">
                  @for (basket of store.baskets(); track basket.id) {
                    @if (basket.id !== store.currentBasketId()) {
                      <li>
                        <a
                          class="dropdown-item"
                          (click)="addSelectedToBasket(basket.id)"
                        >
                        {{ basket.name }}
                        </a>
                      </li>
                      }
                      }
                    </ul>
                  </div>
                  } -->
        </div>
        @if (store.currentBasketId() && selectedConfigurations.length > 0) {
          <button
            class="btn btn-sm btn-outline-primary"
            (click)="removeSelectedFromBasket()"
            title="Remove selected from current basket"
          >
            <i class="fas fa-times me-1"></i>
            Remove from Basket
          </button>
        }
        <button
          class="btn btn-sm btn-outline-secondary"
          (click)="onNewConfiguration()"
        >
          <i class="fas fa-plus me-2"></i>
          Config.
        </button>
      </div>
    </div>
    <div class="d-flex gap-2 pe-2">
      <div class="btn-group">
        <button
          class="btn btn-sm btn-outline-secondary"
          (click)="onResetDatabase()"
        >
          Reset DB
        </button>
        <button
          class="btn btn-sm btn-outline-secondary"
          (click)="onForceDeleteDatabase()"
        >
          Force Delete DB
        </button>
        <button
          class="btn btn-sm btn-outline-secondary"
          (click)="onSeedSampleData()"
        >
          Seed Data
        </button>
      </div>
    </div>
  </div>
</header>

@if (store.error()) {
  <div class="alert alert-danger alert-dismissible">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ store.error() }}
  </div>
}

<app-configuration-grid
  class="flex-grow-1 p-2"
  (rowDoubleClicked)="onRowDoubleClicked($event)"
  (selectionChanged)="onSelectionChanged($event)"
  (typeFilterChanged)="onTypeFilterChanged($event)"
  (searchTermChanged)="onSearchTermChanged($event)"
></app-configuration-grid>

<!-- Basket Creation Modal -->
@if (showBasketModal) {
  <div
    class="modal fade show d-block"
    tabindex="-1"
    style="background-color: rgba(0, 0, 0, 0.5)"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Basket</h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeBasketModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="basketName" class="form-label">Basket Name</label>
            <input
              type="text"
              class="form-control"
              id="basketName"
              [(ngModel)]="newBasketName"
              placeholder="e.g., UAT, Test, Staging"
              (keyup.enter)="createBasket()"
              autofocus
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="closeBasketModal()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="createBasket()"
            [disabled]="!newBasketName.trim()"
          >
            Create Basket
          </button>
        </div>
      </div>
    </div>
  </div>
}
